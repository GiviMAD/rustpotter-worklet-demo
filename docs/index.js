(()=>{var e,t,o={11:function(e){var t;"undefined"!=typeof self&&self,t=()=>(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{NoiseDetectionMode:()=>o,RustpotterService:()=>s}),new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}).decode();const o=Object.freeze({easiest:0,0:"easiest",easy:1,1:"easy",normal:2,2:"normal",hard:3,3:"hard",hardest:4,4:"hardest"});Object.freeze({int:0,0:"int",float:1,1:"float"});var r=function(e,t,o,r){return new(o||(o=Promise))((function(s,i){function n(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,a)}c((r=r.apply(e,t||[])).next())}))};class s{constructor(e={},t){if(this.customSourceNode=t,this.defaultCallback=({data:e})=>{if("detection"===e.type){const{name:t,score:o}=e;return this.onspot(t,o)}},this.onpause=()=>{},this.onresume=()=>{},this.onstart=()=>{},this.onstop=()=>{},this.onspot=(e,t)=>{},!s.isRecordingSupported())throw new Error("Recording is not supported in this browser");this.state="inactive",this.config=Object.assign({workletPath:"/rustpotterWorker.js",wasmPath:"/rustpotter_wasm_bg.wasm",monitorGain:0,recordingGain:1,threshold:.5,averagedThreshold:.25,comparatorRef:.22,comparatorBandSize:6,eagerMode:!0,noiseMode:void 0,noiseSensitivity:.5},e),this.initAudioContext(),this.initialize=this.initWorklet().then((()=>this.initEncoder()))}static isRecordingSupported(){const t=e.g.navigator&&e.g.navigator.mediaDevices&&e.g.navigator.mediaDevices.getUserMedia;return AudioContext&&t&&e.g.WebAssembly}clearStream(){this.stream&&(this.stream.getTracks?this.stream.getTracks().forEach((e=>e.stop())):this.stream.stop())}close(){return this.monitorGainNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode&&this.sourceNode.disconnect(),this.clearStream(),this.processor&&(this.processorNode.disconnect(),this.processor.postMessage({command:"close"})),this.customSourceNode?Promise.resolve():this.audioContext.close()}postBuffers(e){if("recording"===this.state){const t=[];for(let o=0;o<e.numberOfChannels;o++)t[o]=e.getChannelData(o);this.processor.postMessage({command:"process",buffers:t})}}initAudioContext(){var t;const o=e.g.AudioContext||e.g.webkitAudioContext;this.audioContext=(null===(t=this.customSourceNode)||void 0===t?void 0:t.context)?this.customSourceNode.context:new o,this.monitorGainNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.recordingGainNode=this.audioContext.createGain(),this.setRecordingGain(this.config.recordingGain)}initEncoder(){this.audioContext.audioWorklet?(this.processorNode=new AudioWorkletNode(this.audioContext,"rustpotter-worklet",{numberOfOutputs:0}),this.processor=this.processorNode.port):(console.log("audioWorklet support not detected. Falling back to scriptProcessor"),this.processorNode=this.audioContext.createScriptProcessor(4096,1,1),this.processorNode.onaudioprocess=({inputBuffer:e})=>this.postBuffers(e),this.processorNode.connect(this.audioContext.destination),this.processor=new e.g.Worker(this.config.workletPath))}initSourceNode(){return this.customSourceNode?(this.sourceNode=this.customSourceNode,Promise.resolve()):e.g.navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((e=>{this.stream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e)}))}setupListener(){this.processor.removeEventListener("message",this.defaultCallback),this.processor.addEventListener("message",this.defaultCallback)}initWorker(){return new Promise(((e,t)=>{const o=({data:r})=>{switch(r.type){case"rustpotter-ready":return this.processor.removeEventListener("message",o),this.setupListener(),e();case"rustpotter-error":return this.processor.removeEventListener("message",o),t(new Error("Unable to start rustpotter worklet"))}};try{this.processor.addEventListener("message",o),this.processor.start&&this.processor.start(),this.fetchResource(this.config.wasmPath).then((e=>this.processor.postMessage({command:"init",sampleRate:this.audioContext.sampleRate,threshold:this.config.threshold,averagedThreshold:this.config.averagedThreshold,comparatorRef:this.config.comparatorRef,comparatorBandSize:this.config.comparatorBandSize,eagerMode:this.config.eagerMode,wasmBytes:e})))}catch(e){t(e)}}))}initWorklet(){return this.audioContext.audioWorklet?this.audioContext.audioWorklet.addModule(this.config.workletPath):Promise.resolve()}pause(){return"recording"===this.state&&(this.state="paused",this.recordingGainNode.disconnect(),this.onpause()),Promise.resolve()}resume(){"paused"===this.state&&(this.state="recording",this.recordingGainNode.connect(this.processorNode),this.onresume())}setRecordingGain(e){this.config.recordingGain=e,this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)}setMonitorGain(e){this.config.monitorGain=e,this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)}start(){return"inactive"===this.state?(this.state="loading",this.audioContext.resume().then((()=>this.initialize)).then((()=>Promise.all([this.initSourceNode(),this.initWorker()]))).then((()=>{this.state="recording",this.sourceNode.connect(this.monitorGainNode),this.sourceNode.connect(this.recordingGainNode),this.monitorGainNode.connect(this.audioContext.destination),this.recordingGainNode.connect(this.processorNode),this.onstart()})).catch((e=>{throw this.state="inactive",e}))):Promise.resolve()}stop(){return"paused"===this.state||"recording"===this.state?(this.state="inactive",this.recordingGainNode.connect(this.processorNode),this.monitorGainNode.disconnect(),this.clearStream(),new Promise((e=>{const t=({data:o})=>{"done"===o.type&&(this.processor.removeEventListener("message",t),e())};this.processor.addEventListener("message",t),this.processor.start&&this.processor.start(),this.processor.postMessage({command:"done"})})).then((()=>this.finish()))):Promise.resolve()}getState(){return this.state}addWakewordByPath(e){return r(this,void 0,void 0,(function*(){return this.fetchResource(e).then((e=>this.addWakeword(e)))}))}addWakeword(e){return r(this,void 0,void 0,(function*(){return new Promise(((t,o)=>{const r=({data:e})=>{switch(e.type){case"wakeword-loaded":return this.processor.removeEventListener("message",r),t();case"wakeword-error":return this.processor.removeEventListener("message",r),o(new Error("Unable to load wakeword"))}};this.processor.addEventListener("message",r),this.processor.postMessage({command:"wakeword",wakewordBytes:e})}))}))}fetchResource(e){return window.fetch(e).then((e=>e.arrayBuffer()))}finish(){this.onstop()}}return t})(),e.exports=t()},482:(e,t,o)=>{"use strict";e.exports=o.p+"adad65e5e5183000ec7d.js"},125:(e,t,o)=>{"use strict";e.exports=o.p+"595b34e34c0b39876fab.wasm"}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={exports:{}};return o[e].call(i.exports,i,i.exports,s),i.exports}s.m=o,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(o,r){if(1&r&&(o=this(o)),8&r)return o;if("object"==typeof o&&o){if(4&r&&o.__esModule)return o;if(16&r&&"function"==typeof o.then)return o}var i=Object.create(null);s.r(i);var n={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&o;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>n[e]=()=>o[e]));return n.default=()=>o,s.d(i,n),i},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");o.length&&(e=o[o.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s.b=document.baseURI||self.location.href,(()=>{const{NoiseDetectionMode:e}=s(11);(async()=>{const e="rustpotter@Demo";let t={selectedWakeword:null,selectedWakewordBytes:null,selectedThreshold:.5,selectedAvgThreshold:.2,selectedNoiseDectection:null,eagerMode:!0,rustpotterService:null};window.addEventListener("load",(a("loading available wakewords..."),n(!1),i(!1),void fetch("wakewords.json").then((e=>e.json())).then((e=>{const o=document.querySelector("#wakeword_selector"),s=Object.entries(e);s.forEach((e=>{o.innerHTML+='<option value="'+e[1]+'">'+e[0]+"</option>"})),o.innerHTML+='<option value="manual">from file...</option>',t.selectedWakeword=s[0][1],o.disabled=!1,i(!0),r("record"),a("wakewords list loaded")})).catch((e=>{c(e.message??e),n(!1)}))));try{await async function(){const{RustpotterService:e}=await Promise.resolve().then(s.t.bind(s,11,23));if(!e.isRecordingSupported()){const e="Unable to record in this browser :(";throw alert(e),new Error(e)}}(),document.querySelector("#wakeword_selector").addEventListener("change",(function(e){const s=e.target.value;if(t.selectedWakewordBytes=null,"manual"==s)n(!1),document.querySelector("#wakeword_input_container").innerHTML+='<input id="wakeword_input" type="file" accept=".rpw">',document.querySelector("#wakeword_input").addEventListener("change",o);else{let e=document.querySelector("#wakeword_input");e&&e.remove(),r("record")}t.selectedWakeword=s})),document.querySelector("#wakeword_threshold").addEventListener("input",(function(e){t.selectedThreshold=e.target.value})),document.querySelector("#wakeword_avg_threshold").addEventListener("input",(function(e){t.selectedAvgThreshold=e.target.value})),document.querySelector("#eager_mode").addEventListener("input",(function(e){t.eagerMode=e.target.checked})),document.querySelector("#record").addEventListener("click",(async function(){try{const{RustpotterService:e}=await Promise.resolve().then(s.t.bind(s,11,23));if(r("record",!1),i(!1),null!=t.rustpotterService)return t.rustpotterService.resume(),r("pause"),void r("stop");const o=new URL(s(125),s.b),n=new URL(s(482),s.b);t.rustpotterService=new e({workletPath:n.href,wasmPath:o.href,averagedThreshold:t.selectedAvgThreshold,threshold:t.selectedThreshold,eagerMode:t.eagerMode,noiseMode:t.selectedNoiseDectection,noiseSensitivity:.5}),t.rustpotterService.onspot=(e,t)=>{a(`detection: '${e}'[${t}]`)},t.rustpotterService.onstart=function(){a("rustpotterService is started")},t.rustpotterService.onstop=function(){a("rustpotterService is stopped")},t.rustpotterService.onpause=function(){a("rustpotterService is paused")},t.rustpotterService.onresume=function(){a("rustpotterService is resumed")},await t.rustpotterService.start(),"manual"==t.selectedWakeword?t.rustpotterService.addWakeword(t.selectedWakewordBytes):t.rustpotterService.addWakewordByPath(t.selectedWakeword),r("pause"),r("stop")}catch(e){c(e.message??err)}})),document.querySelector("#pause").addEventListener("click",(function(){n(!1),t.rustpotterService.pause().then((()=>{r("record")})).catch((e=>{c(e.message??e)}))})),document.querySelector("#stop").addEventListener("click",(async()=>{n(!1),t.rustpotterService.stop().then(t.rustpotterService.close()).then((()=>{t.rustpotterService=null,r("record"),i(!0)})).catch((e=>{c(e.message??e)}))}))}catch(e){c(e.message??e)}function o(e){const o=new FileReader;o.onload=function(){t.selectedWakewordBytes=this.result,r("record")},o.onerror=function(){c("Unable to read wakeword file."),n(!1)},o.readAsArrayBuffer(this.files[0])}function r(e,t=!0){document.querySelector("#"+e).disabled=!t}function i(e){document.querySelector("#wakeword_panel").querySelectorAll("input,select").forEach((t=>t.disabled=!e))}function n(e){document.querySelector("#btn_panel").querySelectorAll("button").forEach((t=>t.disabled=!e))}function a(t){console.log(t);var o=document.querySelector("#terminal");o.innerHTML+='<span style="color: grey">'+e+'</span> % <span class="ok">'+t+"</span><br>",o.parentElement.scrollTop=o.parentElement.scrollHeight}function c(t){console.error(t);var o=document.querySelector("#terminal");o.innerHTML+='<span style="color: grey">'+e+'</span> % <span class="error">'+t+"</span><br>",o.parentElement.scrollTop=o.parentElement.scrollHeight}})()})()})();