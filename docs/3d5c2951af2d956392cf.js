!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var s in r)("object"==typeof exports?exports:e)[s]=r[s]}}("undefined"!=typeof self?self:this,(()=>(()=>{var e={344:function(e,t,r){!function(e){"use strict";function t(){}function r(){}t.prototype.encode=function(e){for(var t=[],r=e.length,s=0;s<r;){var o=e.codePointAt(s),n=0,i=0;for(o<=127?(n=0,i=0):o<=2047?(n=6,i=192):o<=65535?(n=12,i=224):o<=2097151&&(n=18,i=240),t.push(i|o>>n),n-=6;n>=0;)t.push(128|o>>n&63),n-=6;s+=o>=65536?2:1}return t},globalThis.TextEncoder=t,e.TextEncoder||(e.TextEncoder=t),r.prototype.decode=function(e){if(!e)return"";for(var t="",r=0;r<e.length;){var s=e[r],o=0,n=0;if(s<=127?(o=0,n=255&s):s<=223?(o=1,n=31&s):s<=239?(o=2,n=15&s):s<=244&&(o=3,n=7&s),e.length-r-o>0)for(var i=0;i<o;)n=n<<6|63&(s=e[r+i+1]),i+=1;else n=65533,o=e.length-r;t+=String.fromCodePoint(n),r+=o+1}return t},globalThis.TextDecoder=r,e.TextDecoder||(e.TextDecoder=r)}(typeof globalThis==""+void 0?typeof r.g==""+void 0?typeof self==""+void 0?this:self:r.g:globalThis)},313:(e,t,r)=>{"use strict";e.exports=r.p+"rustpotter_wasm_bg.wasm"}},t={};function r(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,r),n.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="",r.b=void 0;var s={};return(()=>{"use strict";let e;r.r(s),r(344);const t=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});t.decode();let o=null;function n(){return null!==o&&o.buffer===e.memory.buffer||(o=new Uint8Array(e.memory.buffer)),o}function i(e,r){return t.decode(n().subarray(e,e+r))}let a=0;function c(e,t){const r=t(1*e.length);return n().set(e,r/1),a=e.length,r}let p=null,l=null,d=null,u=null;function h(){return null!==u&&u.buffer===e.memory.buffer||(u=new Int32Array(e.memory.buffer)),u}Object.freeze({easiest:0,0:"easiest",easy:1,1:"easy",normal:2,2:"normal",hard:3,3:"hard",hardest:4,4:"hardest"});const f=Object.freeze({int:0,0:"int",float:1,1:"float"});class m{static __wrap(e){const t=Object.create(m.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const t=this.__destroy_into_raw();e.__wbg_rustpotterdetection_free(t)}getName(){try{const s=e.__wbindgen_add_to_stack_pointer(-16);e.rustpotterdetection_getName(s,this.ptr);var t=h()[s/4+0],r=h()[s/4+1];return i(t,r)}finally{e.__wbindgen_add_to_stack_pointer(16),e.__wbindgen_free(t,r)}}getScore(){return e.rustpotterdetection_getScore(this.ptr)}}class _{static __wrap(e){const t=Object.create(_.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const t=this.__destroy_into_raw();e.__wbg_rustpotterjs_free(t)}addWakewordModelBytes(t){const r=c(t,e.__wbindgen_malloc),s=a;e.rustpotterjs_addWakewordModelBytes(this.ptr,r,s)}processInt32(t){const r=function(t,r){const s=r(4*t.length);return(null!==p&&p.buffer===e.memory.buffer||(p=new Uint32Array(e.memory.buffer)),p).set(t,s/4),a=t.length,s}(t,e.__wbindgen_malloc),s=a,o=e.rustpotterjs_processInt32(this.ptr,r,s);return 0===o?void 0:m.__wrap(o)}processInt16(t){const r=function(t,r){const s=r(2*t.length);return(null!==l&&l.buffer===e.memory.buffer||(l=new Uint16Array(e.memory.buffer)),l).set(t,s/2),a=t.length,s}(t,e.__wbindgen_malloc),s=a,o=e.rustpotterjs_processInt16(this.ptr,r,s);return 0===o?void 0:m.__wrap(o)}processInt8(t){const r=c(t,e.__wbindgen_malloc),s=a,o=e.rustpotterjs_processInt8(this.ptr,r,s);return 0===o?void 0:m.__wrap(o)}processFloat32(t){const r=function(t,r){const s=r(4*t.length);return(null!==d&&d.buffer===e.memory.buffer||(d=new Float32Array(e.memory.buffer)),d).set(t,s/4),a=t.length,s}(t,e.__wbindgen_malloc),s=a,o=e.rustpotterjs_processFloat32(this.ptr,r,s);return 0===o?void 0:m.__wrap(o)}getFrameSize(){return e.rustpotterjs_getFrameSize(this.ptr)>>>0}}class y{static __wrap(e){const t=Object.create(y.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const t=this.__destroy_into_raw();e.__wbg_rustpotterjsbuilder_free(t)}static new(){const t=e.rustpotterjsbuilder_new();return y.__wrap(t)}setThreshold(t){e.rustpotterjsbuilder_setThreshold(this.ptr,t)}setAveragedThreshold(t){e.rustpotterjsbuilder_setAveragedThreshold(this.ptr,t)}setBitsPerSample(t){e.rustpotterjsbuilder_setBitsPerSample(this.ptr,t)}setSampleRate(t){e.rustpotterjsbuilder_setSampleRate(this.ptr,t)}setSampleFormat(t){e.rustpotterjsbuilder_setSampleFormat(this.ptr,t)}setChannels(t){e.rustpotterjsbuilder_setChannels(this.ptr,t)}setComparatorBandSize(t){e.rustpotterjsbuilder_setComparatorBandSize(this.ptr,t)}setComparatorRef(t){e.rustpotterjsbuilder_setComparatorRef(this.ptr,t)}setEagerMode(t){e.rustpotterjsbuilder_setEagerMode(this.ptr,t)}setSingleThread(t){e.rustpotterjsbuilder_setSingleThread(this.ptr,t)}setNoiseSensitivity(t){e.rustpotterjsbuilder_setNoiseSensitivity(this.ptr,t)}setNoiseMode(t){e.rustpotterjsbuilder_setNoiseMode(this.ptr,t)}build(){const t=e.rustpotterjsbuilder_build(this.ptr);return _.__wrap(t)}}const g=async function t(s){void 0===s&&(s=new URL(r(313),r.b));const o={wbg:{}};o.wbg.__wbindgen_throw=function(e,t){throw new Error(i(e,t))},("string"==typeof s||"function"==typeof Request&&s instanceof Request||"function"==typeof URL&&s instanceof URL)&&(s=fetch(s));const{instance:n,module:a}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}(await s,o);return e=n.exports,t.__wbindgen_wasm_module=a,e};class w{constructor(e,t,r){if(this.config=t,this.onSpot=r,!this.config.sampleRate)throw new Error("sampleRate value is required to record. NOTE: Audio is not resampled!");this.samplesOffset=0,this.wasmLoadedPromise=(()=>{return t=this,s=function*(){yield g(WebAssembly.compile(e));const t=y.new();t.setSampleRate(this.config.sampleRate),t.setSampleFormat(f.float),t.setBitsPerSample(32),t.setChannels(1),t.setAveragedThreshold(this.config.averagedThreshold),t.setThreshold(this.config.threshold),t.setComparatorRef(this.config.comparatorRef),t.setComparatorBandSize(this.config.comparatorBandSize),t.setEagerMode(this.config.eagerMode),null!=this.config.noiseMode&&(t.setNoiseMode(this.config.noiseMode),t.setNoiseSensitivity(this.config.noiseSensitivity)),this.rustpotterJS=t.build(),this.rustpotterFrameSize=this.rustpotterJS.getFrameSize(),this.samples=new Float32Array(this.rustpotterFrameSize),t.free()},new((r=void 0)||(r=Promise))((function(e,o){function n(e){try{a(s.next(e))}catch(e){o(e)}}function i(e){try{a(s.throw(e))}catch(e){o(e)}}function a(t){var s;t.done?e(t.value):(s=t.value,s instanceof r?s:new r((function(e){e(s)}))).then(n,i)}a((s=s.apply(t,[])).next())}));var t,r,s})()}waitReady(){return this.wasmLoadedPromise}addWakeword(e){this.rustpotterJS.addWakewordModelBytes(e)}process(e){const t=e[0],r=this.samplesOffset+t.length;if(r<=this.rustpotterFrameSize)this.samples.set(t,this.samplesOffset),r==this.rustpotterFrameSize-1?(this.handleDetection(this.rustpotterJS.processFloat32(this.samples)),this.samplesOffset=0):this.samplesOffset=r;else{var s=this.rustpotterFrameSize-this.samplesOffset;this.samples.set(t.subarray(0,s),this.samplesOffset),this.handleDetection(this.rustpotterJS.processFloat32(this.samples));var o=t.subarray(s);o.length>=t.length?(this.samplesOffset=0,this.process([o])):(this.samples.set(o,0),this.samplesOffset=t.length-s)}}handleDetection(e){e&&(this.onSpot(e.getName(),e.getScore()),e.free())}close(){this.rustpotterJS.free()}}if("function"==typeof registerProcessor){class e extends AudioWorkletProcessor{constructor(){super(),this.continueProcess=!0,this.port.onmessage=({data:e})=>{switch(e.command){case"close":this.continueProcess=!1;break;case"done":this.continueProcess=!1,this.recorder&&(this.recorder.close(),this.recorder=null),this.port.postMessage({type:"done"});break;case"init":this.recorder=new w(e.wasmBytes,{sampleRate:e.sampleRate,threshold:e.threshold,averagedThreshold:e.averagedThreshold,comparatorRef:e.comparatorRef,comparatorBandSize:e.comparatorBandSize,eagerMode:e.eagerMode,noiseMode:e.noiseMode,noiseSensitivity:e.noiseSensitivity},((e,t)=>{this.port.postMessage({type:"detection",name:e,score:t})})),this.recorder.waitReady().then((()=>{this.port.postMessage({type:"rustpotter-ready"})})).catch((e=>{console.error(e),this.port.postMessage({type:"rustpotter-error"})}));break;case"wakeword":const t=new Uint8Array(e.wakewordBytes);this.recorder||this.port.postMessage({type:"wakeword-error"});try{this.recorder.addWakeword(t),this.port.postMessage({type:"wakeword-loaded"})}catch(e){console.error(e),this.port.postMessage({type:"wakeword-error"})}}}}process(e){return this.recorder&&e[0]&&e[0].length&&e[0][0]&&e[0][0].length&&this.recorder.process(e[0]),this.continueProcess}}registerProcessor("rustpotter-worklet",e)}else{let e;onmessage=({data:t})=>{switch(t.command){case"process":e&&e.process(t.buffers);break;case"done":if(e){const t=e;e=null,t.close(),postMessage({type:"done"})}break;case"close":close();break;case"init":e=new w(t.wasmBytes,{sampleRate:t.sampleRate,threshold:t.threshold,averagedThreshold:t.averagedThreshold,comparatorRef:t.comparatorRef,comparatorBandSize:t.comparatorBandSize,eagerMode:t.eagerMode,noiseMode:t.noiseMode,noiseSensitivity:t.noiseSensitivity},((e,t)=>{postMessage({type:"detection",name:e,score:t})})),e.waitReady().then((()=>{postMessage({type:"rustpotter-ready"})})).catch((e=>{console.error(e),postMessage({type:"rustpotter-error"})}));break;case"wakeword":const r=new Uint8Array(t.wakewordBytes);e||postMessage({type:"wakeword-error"});try{e.addWakeword(r),postMessage({type:"wakeword-loaded"})}catch(e){console.error(e),postMessage({type:"wakeword-error"})}}}}})(),s})()));